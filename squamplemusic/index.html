<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Squample Music</title>
    <link rel="icon" href="squample.svg" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <header>
        <img class="logo" src="squample.svg" alt="Squample Logo">
        <h1>Squample Music</h1>
    </header>

    <main>
        <h3>Music Player</h3>

        <!-- Album cover -->
        <img id="albumCover" src="" alt="Album Cover" class="album-cover">

        <!-- Dropdowns -->
        <div class="selectors">
            <div class="selector">
                <label for="artistSelect">Artist:</label>
                <select id="artistSelect"></select>
            </div>
            <div class="selector">
                <label for="albumSelect">Album:</label>
                <select id="albumSelect"></select>
            </div>
        </div>

        <!-- Audio player -->
        <audio id="player" controls class="audio-player">
            <source id="audioSource" src="" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>

        <!-- Tracklist -->
        <div id="trackList" class="tracklist"></div>
    </main>
</div>

<script>
    const library = {
        "Tyler The Creator": ["DON'T TAP THE GLASS"]//add a comma here right before the first / if you wish to add more entries! :D
    };

    const artistSelect = document.getElementById('artistSelect');
    const albumSelect = document.getElementById('albumSelect');
    const player = document.getElementById('player');
    const audioSource = document.getElementById('audioSource');
    const albumCover = document.getElementById('albumCover');
    const trackList = document.getElementById('trackList');

    function sanitizeName(name) {
        return name
            .toLowerCase()                       // lowercase
            .replace(/[^a-z0-9]+/g, '-')         // replace non-alphanumerics with dash
            .replace(/^-+|-+$/g, '');            // remove leading/trailing dashes
    }

    // Populate artist dropdown
    for (const artist in library) {
        const option = document.createElement('option');
        option.value = artist;
        option.textContent = artist;
        artistSelect.appendChild(option);
    }

    function updateAlbums() {
        const artist = artistSelect.value;
        albumSelect.innerHTML = '';
        library[artist].forEach(album => {
            const option = document.createElement('option');
            option.value = album;
            option.textContent = album;
            albumSelect.appendChild(option);
        });
        updateSongs();
    }

    async function updateSongs() {
        const artist = artistSelect.value;
        const album = albumSelect.value;

        try {
            const response = await fetch(`artists/${sanitizeName(artist)}/${sanitizeName(album)}/songs.json`);
            const data = await response.json();

            albumCover.src = `artists/${sanitizeName(artist)}/${sanitizeName(album)}/${data.cover}`;

            // Populate tracklist
            trackList.innerHTML = '';
            data.songs.forEach((song, index) => {
                const trackDiv = document.createElement('div');
                trackDiv.className = 'track';
                trackDiv.textContent = `${index + 1}. ${song.title}`;
                trackDiv.dataset.src = song.src;
                trackDiv.addEventListener('click', () => {
                    audioSource.src = `artists/${sanitizeName(artist)}/${sanitizeName(album)}/${song.src}`;
                    player.load();
                    player.play();
                });
                trackList.appendChild(trackDiv);
            });

            // Auto-play first track
            if (data.songs.length > 0) {
                audioSource.src = `artists/${sanitizeName(artist)}/${sanitizeName(album)}/${data.songs[0].src}`;
                player.load();
            }

        } catch (err) {
            console.error("Failed to load songs.json:", err);
        }
    }

    artistSelect.addEventListener('change', updateAlbums);
    albumSelect.addEventListener('change', updateSongs);

    // Initialize
    artistSelect.selectedIndex = 0;
    updateAlbums();
</script>

</body>
</html>
